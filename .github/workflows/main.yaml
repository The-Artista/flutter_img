name: flutter_img

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches:
      - main

jobs:
  semantic_pull_request:
    uses: VeryGoodOpenSource/very_good_workflows/.github/workflows/semantic_pull_request.yml@v1

  spell-check:
    uses: VeryGoodOpenSource/very_good_workflows/.github/workflows/spell_check.yml@v1
    with:
      includes: "**/*.md"
      modified_files_only: false

  steps:
    - name: Publish to pub.dev ðŸš€
      if: contains(steps.update_icons.outputs.PUBLISH, 'YES')
      run: |
        mkdir -p $HOME/.config/dart
        cat <<EOF > $HOME/.config/dart/pub-credentials.json
        {
          "accessToken": "${{ secrets.PUB_CREDS_ACCESS_TOKEN }}",
          "refreshToken": "${{ secrets.PUB_CREDS_REFRESH_TOKEN }}",
          "idToken": "${{ secrets.PUB_CREDS_ID_TOKEN }}",
          "tokenEndpoint": "https://accounts.google.com/o/oauth2/token",
          "scopes": [ "openid", "https://www.googleapis.com/auth/userinfo.email" ],
          "expiration": ${{ secrets.PUB_CREDS_EXPIRATION }}
        }
        EOF
        dart pub publish -f


