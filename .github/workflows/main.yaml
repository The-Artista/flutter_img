name: flutter_img

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches:
      - main

  jobs:
    update:
      runs-on: ubuntu-latest

      steps:
        - name: 📦 Install Dependencies
          run: flutter pub get

        - name: 🔐 Setup Pub Credentials
          if: contains(steps.update_icons.outputs.PUBLISH, 'YES')
          run: |
            mkdir -p $HOME/.config/dart
            cat <<EOF > $HOME/.config/dart/pub-credentials.json
            {
              "accessToken": "${{ secrets.PUB_CREDS_ACCESS_TOKEN }}",
              "refreshToken": "${{ secrets.PUB_CREDS_REFRESH_TOKEN }}",
              "idToken": "${{ secrets.PUB_CREDS_ID_TOKEN }}",
              "tokenEndpoint": "https://accounts.google.com/o/oauth2/token",
              "scopes": [ "openid", "https://www.googleapis.com/auth/userinfo.email" ],
              "expiration": ${{ secrets.PUB_CREDS_EXPIRATION }}
            }

        - name: 🌵 Dry Run
          run: flutter pub publish --dry-run

        - name: 📢 Publish
          run: flutter pub publish -f